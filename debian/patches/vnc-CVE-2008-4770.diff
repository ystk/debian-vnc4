--- common/rfb/CMsgReader.cxx.orig	2006-05-15 18:56:20.000000000 +0200
+++ common/rfb/CMsgReader.cxx	2008-10-16 17:16:20.000000000 +0200
@@ -99,6 +99,8 @@ void CMsgReader::readRect(const Rect& r,
   if (encoding == encodingCopyRect) {
     readCopyRect(r);
   } else {
+    if (encoding > encodingMax)
+      throw Exception("Unknown rect encoding");
     if (!decoders[encoding]) {
       decoders[encoding] = Decoder::createDecoder(encoding, this);
       if (!decoders[encoding]) {
